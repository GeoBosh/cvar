<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Compute expected shortfall (ES) of distributions — ES • cvar</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Compute expected shortfall (ES) of distributions — ES" />
<meta property="og:description" content="ES computes the expected shortfall for distributions specified by the
    arguments. dist is typically a function (or the name of one). What dist
    computes is determined by dist.type, whose default setting is &quot;qf&quot; (the
    quantile function). Other possible settings of dist.type include &quot;cdf&quot;
    and &quot;pdf&quot;.  Additional arguments for dist can be given with the
    &quot;...&quot; arguments.
Except for the exceptions discussed below, a function computing VaR for the specified
    distribution is constructed and the expected shortfall is computed by numerically
    integrating it. The numerical integration can be fine-tuned with argument
    control, which should be a named list, see integrate for the
    available options.
If dist.type is &quot;pdf&quot;, VaR is not computed, Instead, the partial
    expectation of the lower tail is computed by numerical integration of x *
    pdf(x).  Currently the quantile function is required anyway, via argument qf,
    to compute the upper limit of the integral. So, this case is mainly for testing and
    comparison purposes.

A bunch of expected shortfalls is computed if argument x or any of the
    arguments in &quot;...&quot; are of length greater than one. They are recycled to equal
    length, if necessary, using the normal R recycling rules.
intercept and slope can be used to compute the expected shortfall for
    the location-scale transformation Y = intercept + slope * X, where the
    distribution of X is as specified by the other parameters and Y is the
    variable of interest. The expected shortfall of X is calculated and then
    transformed to that of Y. Note that the distribution of X doesn't need
    to be standardised, although it typically will.
The intercept and the slope can be vectors. Using them may be
    particularly useful for cheap calculations in, for example, forecasting, where the
    predictive distributions are often from the same family, but with different location
    and scale parameters. Conceptually, the described treatment of intercept and
    slope is equivalent to recycling them along with the other arguments, but more
    efficiently.
The names, intercept and slope, for the location and scale parameters
    were chosen for their expressiveness and to minimise the possibility for a clash with
    parameters of dist (e.g., the Gamma distribution has parameter scale)." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cvar</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/GeoBosh/cvar/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Compute expected shortfall (ES) of distributions</h1>
    <small class="dont-index">Source: <a href='https://github.com/GeoBosh/cvar/blob/master/R/VaR.R'><code>R/VaR.R</code></a></small>
    <div class="hidden name"><code>ES.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>ES</code> computes the expected shortfall for distributions specified by the
    arguments. <code>dist</code> is typically a function (or the name of one). What <code>dist</code>
    computes is determined by <code>dist.type</code>, whose default setting is <code>"qf"</code> (the
    quantile function). Other possible settings of <code>dist.type</code> include <code>"cdf"</code>
    and <code>"pdf"</code>.  Additional arguments for <code>dist</code> can be given with the
    <code>"..."</code> arguments.</p>
<p>Except for the exceptions discussed below, a function computing VaR for the specified
    distribution is constructed and the expected shortfall is computed by numerically
    integrating it. The numerical integration can be fine-tuned with argument
    <code>control</code>, which should be a named list, see <code><a href='https://rdrr.io/r/stats/integrate.html'>integrate</a></code> for the
    available options.</p>
<p>If <code>dist.type</code> is <code>"pdf"</code>, VaR is not computed, Instead, the partial
    expectation of the lower tail is computed by numerical integration of <code>x *
    pdf(x)</code>.  Currently the quantile function is required anyway, via argument <code>qf</code>,
    to compute the upper limit of the integral. So, this case is mainly for testing and
    comparison purposes.</p>

<p>A bunch of expected shortfalls is computed if argument <code>x</code> or any of the
    arguments in <code>"..."</code> are of length greater than one. They are recycled to equal
    length, if necessary, using the normal <span style="R">R</span> recycling rules.</p>
<p><code>intercept</code> and <code>slope</code> can be used to compute the expected shortfall for
    the location-scale transformation <code>Y = intercept + slope * X</code>, where the
    distribution of <code>X</code> is as specified by the other parameters and <code>Y</code> is the
    variable of interest. The expected shortfall of <code>X</code> is calculated and then
    transformed to that of <code>Y</code>. Note that the distribution of <code>X</code> doesn't need
    to be standardised, although it typically will.</p>
<p>The <code>intercept</code> and the <code>slope</code> can be vectors. Using them may be
    particularly useful for cheap calculations in, for example, forecasting, where the
    predictive distributions are often from the same family, but with different location
    and scale parameters. Conceptually, the described treatment of <code>intercept</code> and
    <code>slope</code> is equivalent to recycling them along with the other arguments, but more
    efficiently.</p>
<p>The names, <code>intercept</code> and <code>slope</code>, for the location and scale parameters
    were chosen for their expressiveness and to minimise the possibility for a clash with
    parameters of <code>dist</code> (e.g., the Gamma distribution has parameter <code>scale</code>).</p>
    </div>

    <pre class="usage"><span class='fu'>ES</span><span class='op'>(</span><span class='va'>dist</span>, x <span class='op'>=</span> <span class='fl'>0.05</span>, dist.type <span class='op'>=</span> <span class='st'>"qf"</span>, <span class='va'>qf</span>, <span class='va'>...</span>, intercept <span class='op'>=</span> <span class='fl'>0</span>,
  slope <span class='op'>=</span> <span class='fl'>1</span>, control <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>dist</th>
      <td><p>specifies the distribution whose ES is computed, usually a function or a name
of a function computing quantiles, cdf, pdf, or a random number generator, see
Details.</p></td>
    </tr>
    <tr>
      <th>x</th>
      <td><p>level, default is 0.05</p></td>
    </tr>
    <tr>
      <th>dist.type</th>
      <td><p>a character string specifying what is computed by <code>dist</code>, such as
"qf" or "cdf".</p></td>
    </tr>
    <tr>
      <th>qf</th>
      <td><p>quantile function, only used if <code>dist.type = "pdf"</code>.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>passed on to <code>dist</code>.</p></td>
    </tr>
    <tr>
      <th>intercept, slope</th>
      <td><p>requests the ES for the linear transformation <code>intercept +
slope*X</code>, where <code>X</code> has distribution specified by <code>dist</code>, see Details.</p></td>
    </tr>
    <tr>
      <th>control</th>
      <td><p>additional control parameters for the numerical integration routine.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>a numeric vector</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'>ES</span><span class='op'>(</span><span class='va'>qnorm</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] 2.062713</div><div class='input'>
<span class='co'>## Gaussian</span>
<span class='fu'>ES</span><span class='op'>(</span><span class='va'>qnorm</span>, dist.type <span class='op'>=</span> <span class='st'>"qf"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] 2.062713</div><div class='input'><span class='fu'>ES</span><span class='op'>(</span><span class='va'>pnorm</span>, dist.type <span class='op'>=</span> <span class='st'>"cdf"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] 2.062713</div><div class='input'>
<span class='co'>## t-dist</span>
<span class='fu'>ES</span><span class='op'>(</span><span class='va'>qt</span>, dist.type <span class='op'>=</span> <span class='st'>"qf"</span>, df <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] 3.20287</div><div class='input'><span class='fu'>ES</span><span class='op'>(</span><span class='va'>pt</span>, dist.type <span class='op'>=</span> <span class='st'>"cdf"</span>, df <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] 3.20287</div><div class='input'>
<span class='fu'>ES</span><span class='op'>(</span><span class='va'>pnorm</span>, x<span class='op'>=</span> <span class='fl'>0.95</span>, dist.type <span class='op'>=</span> <span class='st'>"cdf"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] 0.1085638</div><div class='input'><span class='fu'>ES</span><span class='op'>(</span><span class='va'>qnorm</span>, x<span class='op'>=</span> <span class='fl'>0.95</span>, dist.type <span class='op'>=</span> <span class='st'>"qf"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] 0.1085638</div><div class='input'><span class='co'>## - VaRES::esnormal(0.95, 0, 1)</span>
<span class='co'>## - PerformanceAnalytics::ETL(p=0.05, method = "gaussian", mu = 0,</span>
<span class='co'>##                             sigma = 1, weights = 1)             # same</span>

<span class='fu'>cvar</span><span class='fu'>::</span><span class='fu'>ES</span><span class='op'>(</span><span class='va'>pnorm</span>, dist.type <span class='op'>=</span> <span class='st'>"cdf"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] 2.062713</div><div class='input'><span class='fu'>cvar</span><span class='fu'>::</span><span class='fu'>ES</span><span class='op'>(</span><span class='va'>qnorm</span>, dist.type <span class='op'>=</span> <span class='st'>"qf"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] 2.062713</div><div class='input'><span class='fu'>cvar</span><span class='fu'>::</span><span class='fu'>ES</span><span class='op'>(</span><span class='va'>pnorm</span>, x<span class='op'>=</span> <span class='fl'>0.05</span>, dist.type <span class='op'>=</span> <span class='st'>"cdf"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] 2.062713</div><div class='input'><span class='fu'>cvar</span><span class='fu'>::</span><span class='fu'>ES</span><span class='op'>(</span><span class='va'>qnorm</span>, x<span class='op'>=</span> <span class='fl'>0.05</span>, dist.type <span class='op'>=</span> <span class='st'>"qf"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] 2.062713</div><div class='input'>
<span class='co'>## this uses "pdf"</span>
<span class='fu'>cvar</span><span class='fu'>::</span><span class='fu'>ES</span><span class='op'>(</span><span class='va'>dnorm</span>, x <span class='op'>=</span> <span class='fl'>0.05</span>, dist.type <span class='op'>=</span> <span class='st'>"pdf"</span>, qf <span class='op'>=</span> <span class='va'>qnorm</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] 2.062713</div><div class='input'>

<span class='co'>## this gives warning (it does more than simply computing ES):</span>
<span class='co'>## PerformanceAnalytics::ETL(p=0.95, method = "gaussian", mu = 0, sigma = 1, weights = 1)</span>

<span class='co'>## run this if VaRRES is present</span>
<span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fl'>0.01</span>, <span class='fl'>0.99</span>, length <span class='op'>=</span> <span class='fl'>100</span><span class='op'>)</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>sapply</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='kw'>function</span><span class='op'>(</span><span class='va'>p</span><span class='op'>)</span> <span class='fu'>cvar</span><span class='fu'>::</span><span class='fu'>ES</span><span class='op'>(</span><span class='va'>qnorm</span>, x <span class='op'>=</span> <span class='va'>p</span>, dist.type <span class='op'>=</span> <span class='st'>"qf"</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>yS</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>sapply</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='kw'>function</span><span class='op'>(</span><span class='va'>p</span><span class='op'>)</span> <span class='op'>-</span> <span class='fu'>VaRES</span><span class='fu'>::</span><span class='fu'>esnormal</span><span class='op'>(</span><span class='va'>p</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/lines.html'>lines</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>yS</span>, col <span class='op'>=</span> <span class='st'>"blue"</span><span class='op'>)</span>
<span class='op'>}</span>

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Georgi N. Boshnakov.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


